{% extends 'base.html.twig' %}

{% set citation = [] %}
{% set banner = [] %}
{% set description = [] %}
{% set image = [] %}
{% set counters = [] %}
{% set metaTitle = [] %}
{% set metaDescription = [] %}


{% set settings = render(controller('AppBundle:Rest/ParentRest:getSettings', {'objectClass':data.getClassName, 'objectId':data.id } ))|json_decode %}

    {% for key, setting in settings %}

        {% if 'citation' in setting.slug %}
            {% set citation = render(controller('AppBundle:Rest/ParentRest:getInfo', {'objectClass':setting.toClassName, 'objectId':setting.toId } ))|json_decode %}
            {% set settings = settings|slice(key) %}
        {% elseif 'banner' in setting.slug %}
            {% set banner = render(controller('AppBundle:Rest/ParentRest:getInfo', {'objectClass':setting.toClassName, 'objectId':setting.toId } ))|json_decode %}
        {% elseif 'counter' in setting.slug %}
            {% set counters = render(controller('AppBundle:Rest/ParentRest:getInfo', {'objectClass':setting.toClassName, 'objectId':setting.toId } ))|json_decode %}
        {% elseif 'description' in setting.slug and 'meta' not in setting.slug %}
            {% set description = render(controller('AppBundle:Rest/ParentRest:getInfo', {'objectClass':setting.toClassName, 'objectId':setting.toId } ))|json_decode %}
        {% elseif 'image' in setting.slug %}
            {% set image = render(controller('AppBundle:Rest/ParentRest:getInfo', {'objectClass':setting.toClassName, 'objectId':setting.toId } ))|json_decode %}
        {% elseif 'meta-title' in setting.slug %}
            {% set metaTitle = render(controller('AppBundle:Rest/ParentRest:getInfo', {'objectClass':setting.toClassName, 'objectId':setting.toId } ))|json_decode %}
        {% elseif 'meta-description' in setting.slug %}
            {% set metaDescription = render(controller('AppBundle:Rest/ParentRest:getInfo', {'objectClass':setting.toClassName, 'objectId':setting.toId } ))|json_decode %}
        {% endif %}



    {% endfor %}

{% block meta_seo %}
    <meta content="" name="description"/>
    <meta content="" name="keywords"/>
    <meta content="http://merx.usavin.com" name="author"/>
    <meta property="og:title" content="{{ metaTitle|length >0 ? metaTitle.value : 'asphalt-moscow.ru' }}"/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="http://www.asphalt-moscow.ru"/>
    <meta property="og:image" content="{{ 'http://'~host }}{{ asset(banner|length >0 ? banner.downloadLink : 'bundles/app/img/asphalt_moscow.png') }}"/>
    <meta property="og:description"
          content="{{ metaDescription|length >0 ? metaDescription.value : 'asphalt-moscow.ru' }}"/>
    <meta property="og:image:width" content="1800"/>
    <meta property="og:image:height" content="945"/>
{% endblock %}

{% block header %}

    <header class="parent-header" style="background: url({{ asset(banner|length >0 ? banner.downloadLink : 'bundles/app/img/header4.jpg')|lbImageFilter('banner_home') }}) no-repeat center top fixed; background-size: cover">
        <div class="bg-overlay pattern">
            {% block menu %}
                {{ render(controller('AppBundle:Rest/ParentRest:getMenu')) }}
            {% endblock menu %}
            {% block main_citation %}
                <section class="intro">
                    <div class="intro-body">
                        <div class="container">
                            <div class="row">
                                <div class="col-lg-12 page-name">
                                    <h1 >{{ data.name|capitalize }}</h1>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            {% endblock %}
        </div>
    </header>

    {#<!-- Particlesground header -->#}
    {#<header class="page-header parallax-section " data-stellar-background-ratio="0.5"#}
            {#style="background-image: url({{ asset(banner|length >0 ? banner.downloadLink : 'bundles/app/img/header4.jpg')|lbImageFilter('banner_home') }});">#}
        {#<div class="container">#}
            {#<h1>{{ data.name }}</h1>#}
            {#<ul id="breadcrumbs" class="breadcrumbs">#}
                {#<li class="item-home">#}
                    {#<a class="bread-link bread-home" href="{{ path('homepage') }}" title="Главное">Home</a>#}
                {#</li>#}
                {#<li class="separator separator-home"><span class="delimiter"> | </span></li>#}
                {#<li class="item-current item-95"><span class="bread-current ">{{ data.name }}</span>#}
                {#</li>#}
            {#</ul>#}
        {#</div>#}
    {#</header>#}
{% endblock header %}

{% block content %}
     <section id="portfolio" class="section-content section about-section">
            <div class="container">
                <div class="row mbxxl">
                    <div class="col-md-12">
                        <h2 class="section-heading">{% if citation|length >0 %} <span>{{- citation.value|replace({' ' : '&nbsp;</span>'})|raw -}} {% endif %}</h2>
                        <div class="line"></div>
                        <p class="section-description"><h4>{{ description.value|raw }}</h4></p>

                    </div>
                </div>
            </div>
     </section>
    {#<section class="">#}
        {#<div class="row mbxxl">#}
            {#<div class="col-md-12">#}
                {#<h2 class="section-heading">{% if citation|length >0 %} <span>{{- citation.value|replace({' ' : '&nbsp;</span>'})|raw -}} {% endif %}</h2>#}
                {#<div class="line"></div>#}
                {#<p class="section-description">{{ description.value|raw }}</p>#}

            {#</div>#}
        {#</div>#}
        {#<div class="container">#}
            {#<div class="row mbxxl">#}
            {#<div class="col-lg-12">#}
            {#<h2 class="section-heading"></h2>#}
            {#</div>#}
            {#</div>#}
            {#<div class="row space-between">#}
                {#<div class="col-md-12 col-lg-6 col-xl-5 ">#}

                {#</div>#}
                {#<div class=" img-block offset-md-1  col-md-10  offset-lg-0 col-lg-6 col-xl-6">#}
                    {#<img src="{{ asset(image.downloadLink)|lbImageFilter('list_big') }}" alt="" class="img-responsive">#}
                {#</div>#}
            {#</div>#}
        {#</div>#}
    {#</section>#}

    {% if counters|length >0 %}

        {% set settings = render(controller('AppBundle:Rest/ParentRest:getSettings', {'objectClass':counters.objectClass, 'objectId':counters.id } ))|json_decode %}

        {% set background = [] %}
        {% set counter = [] %}

        {% for key,setting in settings %}

            {% if 'background' in setting.slug %}
                {% set background = render(controller('AppBundle:Rest/ParentRest:getInfo', {'objectClass':setting.toClassName, 'objectId':setting.toId } ))|json_decode %}
            {% else %}
                {% set counter = counter|merge([render(controller('AppBundle:Rest/ParentRest:getInfo', {'objectClass':setting.toClassName, 'objectId':setting.toId } ))|json_decode]) %}
            {% endif %}

        {% endfor %}

        {% if counter|length > 0 %}
            <section id="about-2" class="section-content section-parallax">
                <div class="bg-overlay pattern">
                    <div class="container">
                        {#<div class="row mbxxl">#}
                            {#<div class="col-lg-12">#}
                                {#<h2 class="section-heading">What our fun <span>factors</span></h2>#}
                            {#</div>#}
                        {#</div>#}
                        <div class="row">
                            {% for key,count in counter %}
                                {% set name = [] %}
                                {% set value = [] %}
                                {% set percent = [] %}
                                {% set settings = render(controller('AppBundle:Rest/ParentRest:getSettings', {'objectClass':count.objectClass, 'objectId':count.id } ))|json_decode %}

                                {% for setting in settings %}

                                    {% if 'name' in setting.slug %}
                                        {% set name = render(controller('AppBundle:Rest/ParentRest:getInfo', {'objectClass':setting.toClassName, 'objectId':setting.toId } ))|json_decode %}
                                    {% elseif 'value' in setting.slug %}
                                        {% set value = render(controller('AppBundle:Rest/ParentRest:getInfo', {'objectClass':setting.toClassName, 'objectId':setting.toId } ))|json_decode %}
                                    {% elseif 'percent' in setting.slug %}
                                        {% set percent = render(controller('AppBundle:Rest/ParentRest:getInfo', {'objectClass':setting.toClassName, 'objectId':setting.toId } ))|json_decode %}
                                    {% endif %}

                                {% endfor %}
                                <div data-value="{{ value.value }}" class="col-lg-3 text-center mbl fact">
                                    <h2 class="factor">{{ value.value }}</h2>
                                    <h3 class="factor-desc">{{ name.value }}</h3>
                                </div>

                            {% endfor %}

                        </div>
                    </div>
                </div>
            </section>
        {% endif %}
    {% endif %}
{% endblock %}

{% block js %}
    {{ parent() }}
    <script src="{{ asset('bundles/app/js/libs/waipoints.js') }}"></script>
    <script src="{{ asset('bundles/app/js/libs/progressbar.min.js') }}"></script>
{% endblock %}